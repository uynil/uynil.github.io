---
layout: post
title: 领域驱动设计odoo模块
tags: [odoo, ddd]

---



在odoo定制过程中，无论是OCA社区还是我司，定制模块设计，增强原生模块功能，为了不影响原生模块，通常以功能考虑为主，一个功能一个模块。例如，我司的V7的 stock_internal_message模块，在内部调拨上整合消息,  单独模块，模块重用就很方便。这么做的主要原因是，后续出现功能上的缺陷维护追踪度高、功能升级直接，模块重用方便；在软件开发，项目协作上，更是有利，模块维度降低，开发更快捷，代码审核功能便捷。

但是在实践过程中，往往碰到了一些问题。很多模块社区上下载，不能直接安装；很多功能本地上，顺利安装测试通过，一旦放在客户测试环境中，部署出现问题，测试出现问题，最后正式环境部署发布，更是压力山大。

在持续部署的理念中，有提出团队解耦、模块解耦的方法，减少测试上的bug，下面基于此来讨论如何减少odoo 模块设计上的问题，软件交付更加顺利。


## 一个功能一个模块
目前为了 增加odoo原生模块的功能，同时为了增强模块不影响原生功能的升级和缺陷修复，我们会在功能卸载额外模块上，并把模块按单独功能分开编写。

> 举例，销售模块上的功能交叉：折扣功能，magento整合，销售额度限制 这三个功能。这三个模块都会重写sale_order_line 的 product_id_onchange 函数，而这个函数本身很难集成，大部分都是重写，每个模块单独测试影响不大，集成测试时，就会发生相互影响的问题，甚至安装模块的顺序，部署的方式也可能会影响最终有没有bug；三个模块也同时都可能调整销售订单界面，界面调整也会互相影响； 这三个模块升级时，一个模块的功能升级缺陷修复界面调整，很有可能会引起另外一个模块产生新的缺陷，甚至界面调整失效。
 

> Magento 的社区模块也有此项问题，社区上的模块下载下来往往不能使用，因为模块之间的耦合严重，每个magento的实例本身 可能已经修改了 社区模块依赖的基础，安装后自然不能使用，需要调整。

## 领域驱动设计和持续部署

> 领域驱动设计的定义为， 待添加。

在odoo当中实践为， 销售功能合并为一个模块，生产功能为一个模块，销售跟生产之间整合通过各自提供的借口控制，调整接口时要考虑双方模块的稳定性。

以上例举例， 把 销售折扣，销售额度限制 整合进 销售模块内， magento 模块 不直接修改 product_id_onchange 函数，而是 销售模块提供 修改函数接口， magento通过调用接口调整。

再举例，销售、采购模块都需要调整共用 partnter对象，那么partner对象就应该由单独的partner模块负责，统一调整修改，这样才能避免引起模块之间的混乱和影响。

这种设计可以把模块间的耦合减少，在项目中，一个新模块新功能的发布不会导致另一个模块的新的缺陷。

在此，我希望这个思路可以抛砖引玉，帮助各位odooer，以领域驱动设计模式的设计分割模块, 发布更多更强新的模块。


## [寰享科技(深圳) 正在招聘 初级/高级odoo 技术工程师][job_link]
[job_link]: http://simple-is-better.com/jobs/866 "Eilco Shenzhen hire odoo developers"

如果有任何疑问，欢迎发邮件到 lin.yu#elico-corp.com 跟我讨论。（# 改成@）
