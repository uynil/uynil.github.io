---
layout: post
title: Python 垃圾回收机制
tags: [Python]
---
#### 1. Python中的垃圾回收是以引用计数为主，分代收集为辅。
上一篇文章说到，python 的内存管理机制为引用机制。

#### 2. 引用计数
在Python中，如果一个对象的引用数为0，Python虚拟机就会回收这个对象的内存。

计数+1的情况：
  对象创建 a = 24
  对象引用 b = a
  函数传递参数 func(a)
  放在容器中 list1 = [a]

计数-1的情况
  del a
  变量改值 a = 25
  退出函数 (局部变量)
  容器销毁，或容器中的对象被删除

引用计数的缺陷是循环引用的问题。

调用函数会令引用计数+2: 参数+1， 函数执行+1

查看计数: sys.getrefcount(a)

#### 3. 循环引用
``` python
  def f2():
      while True:
          c1=ClassA()
          c2=ClassA()
          c1.t=c2
          c2.t=c1
          del c1
          del c2
```
每次循环， c1, c2 引用数+1，内存不断加大


#### 4. 垃圾回收

垃圾回收后的对象会放在gc.garbage列表里面

gc.collect()会返回不可达的对象数目，4等于两个对象以及它们对应的dict

有三种情况会触发垃圾回收：
  1.调用gc.collect(),
  2.当gc模块的计数器达到阀值的时候。
  3.程序退出的时候

#### 5. 分代回收

在Python中，采用分代收集的方法。把对象分为三代，一开始，对象在创建的时候，放在一代中，如果在一次一代的垃圾检查中，改对象存活下来，就会被放到二代中，同理在一次二代的垃圾检查中，该对象存活下来，就会被放到三代中。


### 参考文章
1. python gabbage 问题: http://www.cnblogs.com/Xjng/p/5128269.html
